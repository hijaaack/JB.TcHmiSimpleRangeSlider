var TcHmi;!function(TcHmi){!function(Controls){!function(Beckhoff){class TcHmiUserManagement extends TcHmi.Controls.System.TcHmiControl{constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__resizedEventDestroyEvent=null,this.__movedEventDestroyEvent=null,this.__dropdownboxOpen=!1,this.__dropdownEventDestroyFunction=[],this.__touches=[],this.__mouseDown=!1,this.__advanced=!1,this.__localizedElements=new Map,this.__localizationReader=void 0,this.__destroyLocalizationWatch=null,this.__onUserDataChangedDestroyer=null,this.__showUsermanagementButtons={editUser:!1,userManagement:!1},this.__onDocumentClick=evt=>{!this.__dropdownboxOpen||this.__element[0].contains(evt.target)||this.__elementDropdown.contains(evt.target)||(this.__setDropDownboxOpen(!1),TcHmi.EventProvider.raise(this.__id+".onUserInteractionCanceled"))},this.__resizeDropDownBox=evt=>{const documentBCR=document.documentElement.getBoundingClientRect(),controlBCR=this.__element[0].getBoundingClientRect(),dropdownBCR=this.__elementDropdown.getBoundingClientRect();let style={top:controlBCR.top+controlBCR.height+"px",left:controlBCR.left+"px",right:null,"min-width":controlBCR.width+"px","max-height":documentBCR.height-controlBCR.bottom+"px"};documentBCR.height-controlBCR.bottom<controlBCR.top&&dropdownBCR.height>documentBCR.height-controlBCR.bottom?(style.top=controlBCR.top-dropdownBCR.height+"px",style["max-height"]=controlBCR.top+"px",this.__elementDropdown.classList.add("above-control")):this.__elementDropdown.classList.remove("above-control"),documentBCR.width-controlBCR.left<dropdownBCR.width&&controlBCR.right>=dropdownBCR.width&&(style.left=null,style.right=documentBCR.width-controlBCR.right+"px"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementDropdown,style)},this.__onResolverForTextColorWatchCallback=data=>{!1===this.__isAttached&&data.destroy&&this.__suspendObjectResolver("textColor"),tchmi_equal(data.value,this.__textColor)||(this.__textColor=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextColor"}),this.__processTextColor())},this.__evtHandlerMouseEnter=this.__onMouseEnter(),this.__evtHandlerMouseLeave=this.__onMouseLeave(),this.__evtHandlerLogout=this.__onLogout(),this.__evtHandlerSwitchUser=this.__onSwitchUser(),this.__evtHandlerEditUser=this.__onEditUser(),this.__evtHandlerUserManagement=this.__onUserManagement(),this.__evtHandlerMouseUp=this.__onMouseUp()}__previnit(){if(this.__elementTemplateRoot=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-Template")[0],!this.__elementTemplateRoot)throw new Error("Invalid Template.html");if(this.__elementBase=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-Base")[0],!this.__elementBase)throw new Error("Invalid Template.html");if(this.__elementDropdown=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-Dropdown")[0],!this.__elementDropdown)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementDropdown),this.__elementEditUserPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-editUser-popup")[0],!this.__elementEditUserPopup)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementEditUserPopup),this.__elementManageUserPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-usermanagement-popup")[0],!this.__elementManageUserPopup)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementManageUserPopup),this.__elementAddUserPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-addUser-popup")[0],!this.__elementAddUserPopup)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementAddUserPopup),this.__elementDeleteUserPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-deleteUser-popup")[0],!this.__elementDeleteUserPopup)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementDeleteUserPopup),this.__elementChangeGroupsPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-changeGroups-popup")[0],!this.__elementChangeGroupsPopup)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementChangeGroupsPopup),this.__elementSwitchUserPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-switchUser-popup")[0],!this.__elementSwitchUserPopup)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementSwitchUserPopup),this.__elementNotificationPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-notification-popup")[0],!this.__elementNotificationPopup)throw new Error("Invalid Template.html");if(this.__elementTemplateRoot.removeChild(this.__elementNotificationPopup),this.__elementWarningPopup=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-warning-popup")[0],!this.__elementWarningPopup)throw new Error("Invalid Template.html");this.__elementTemplateRoot.removeChild(this.__elementWarningPopup);let localizedElements=this.__element[0].querySelectorAll("[data-tchmi-localized-content-key]");for(let i=0,ii=localizedElements.length;i<ii;i++){let element=localizedElements[i],localizeKey=element.dataset.tchmiLocalizedContentKey;localizeKey&&this.__localizedElements.set(element,{key:localizeKey})}this.__destroyLocalizationWatch=this.__localization.watch((data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}})),super.__previnit()}__init(){super.__init()}__attach(){super.__attach();const passiveEventOptions={passive:!0,capture:!1};document.addEventListener("mouseup",this.__evtHandlerMouseUp,passiveEventOptions),document.addEventListener("touchend",this.__evtHandlerMouseUp,passiveEventOptions),this.__dropdownEventDestroyFunction.push(TcHmi.EventProvider.register(this.getId()+".onPressed",this.__onExpandDropdown())),this.__dropdownEventDestroyFunction.push(TcHmi.EventProvider.register(this.getId()+".onMouseDown",this.__onExpandDropdownMouseDown())),this.__dropdownEventDestroyFunction.push(TcHmi.EventProvider.register(this.getId()+".onTouchStart",this.__onExpandDropdownMouseDown())),this.__dropdownEventDestroyFunction.push(TcHmi.EventProvider.register(this.getId()+".onMouseEnter",this.__onExpandDropdownMouseEnter())),this.__dropdownEventDestroyFunction.push(TcHmi.EventProvider.register(this.getId()+".onMouseLeave",this.__onExpandDropdownMouseLeave())),this.__dropdownEventDestroyFunction.push(TcHmi.EventProvider.register(this.getId()+".onTouchEnd",this.__onExpandDropdownMouseLeave())),this.__dropdownEventDestroyFunction.push(TcHmi.EventProvider.register(this.getId()+".onTouchCancel",this.__onExpandDropdownMouseLeave())),this.__onUserDataChangedDestroyer=TcHmi.EventProvider.register("onUserDataChanged",this.__onUserDataChanged());let userName=TcHmi.Server.getCurrentUser();this.__elementBase.innerText=null!==userName?userName:"<unknown>",this.__getApiAccessForDomains()}__detach(){super.__detach();const passiveEventOptions={passive:!0,capture:!1};document.removeEventListener("mouseup",this.__evtHandlerMouseUp,passiveEventOptions),document.removeEventListener("touchend",this.__evtHandlerMouseUp,passiveEventOptions),this.__removeDropDownbutton(this.__logoutButton,this.__evtHandlerLogout),this.__removeDropDownbutton(this.__switchUserButton,this.__evtHandlerSwitchUser),this.__removeDropDownbutton(this.__userManagementButton,this.__evtHandlerUserManagement),this.__removeDropDownbutton(this.__editUserButton,this.__evtHandlerEditUser);for(let event of this.__dropdownEventDestroyFunction)event();this.__dropdownEventDestroyFunction=[],this.__onUserDataChangedDestroyer?.(),this.__onUserDataChangedDestroyer=null}destroy(){this.__keepAlive||(super.destroy(),this.__switchUserPopup?.destroy(),this.__switchUserPopup=void 0,this.__editUserPopup?.destroy(),this.__editUserPopup=void 0,this.__manageUserPopup?.destroy(),this.__manageUserPopup=void 0,this.__resizedEventDestroyEvent?.(),this.__resizedEventDestroyEvent=null,this.__movedEventDestroyEvent?.(),this.__movedEventDestroyEvent=null,this.__destroyLocalizationWatch?.(),this.__destroyLocalizationWatch=null)}__setDropDownboxOpen(valueNew){if(void 0===valueNew&&(valueNew=!this.__dropdownboxOpen),valueNew){this.__dropdownboxOpen=!0;let topMostLayerOptions={removeCb:data=>{this.__dropdownboxOpen=!1,this.__elementTemplateRoot.classList.remove("active"),this.__elementDropdown.classList.remove("active"),null!==this.__resizedEventDestroyEvent&&(this.__resizedEventDestroyEvent(),this.__resizedEventDestroyEvent=null),null!==this.__movedEventDestroyEvent&&(this.__movedEventDestroyEvent(),this.__movedEventDestroyEvent=null),document.removeEventListener("scroll",this.__resizeDropDownBox,{capture:!0}),window.removeEventListener("resize",this.__resizeDropDownBox);document.removeEventListener("click",this.__onDocumentClick,{passive:!0,capture:!1})},dimBackground:!1,modal:!1};this.__resizedEventDestroyEvent=TcHmi.EventProvider.register(this.__id+".onResized",this.__resizeDropDownBox),this.__movedEventDestroyEvent=TcHmi.EventProvider.register(this.__id+".onMoved",this.__resizeDropDownBox),document.addEventListener("scroll",this.__resizeDropDownBox,{capture:!0,passive:!0}),window.addEventListener("resize",this.__resizeDropDownBox,{passive:!0});const passiveEventOptions={passive:!0,capture:!1};document.addEventListener("click",this.__onDocumentClick,passiveEventOptions),TcHmi.TopMostLayer.add(this,this.__elementDropdown,topMostLayerOptions),this.__resizeDropDownBox()}else TcHmi.TopMostLayer.remove(this,this.__elementDropdown)}updateDropdown(){this.__getApiAccessForDomains()}__getApiAccessForDomains(){TcHmi.Server.readSymbol("ListDomains",(data=>{const domainList=data.response?.commands?.[0].readValue;if(data.error===TcHmi.Errors.NONE&&domainList){const domains=[];for(let[domainName,domain]of Object.entries(domainList))domain?.authExtension&&domains.push(domainName);let showUsermanagementButtons={editUser:!1,userManagement:!1},accessCount=0;domains.forEach((domain=>{TcHmi.Server.UserManagement.getApiAccess({domain:domain},(data=>{accessCount++,data.error===TcHmi.Errors.NONE&&data.result&&((data.result.updateUser.changeOwnPassword||data.result.updateUser.addGroups&&data.result.updateUser.removeGroups||data.result.updateUser.locale||data.result.updateUser.timeZone)&&TcHmi.Access.checkAccess(this,"EditUserProperties")&&(showUsermanagementButtons.editUser=!0),(data.result.addUser.general||data.result.removeUser.general||data.result.updateUser.addGroups&&data.result.updateUser.removeGroups)&&TcHmi.Access.checkAccess(this,"UserManagement")&&(showUsermanagementButtons.userManagement=!0)),accessCount>=domains.length&&(this.__showUsermanagementButtons=showUsermanagementButtons,this.__fillDropdown())}))}))}}))}__fillDropdown(){let fragment=document.createDocumentFragment();this.__allowLogout&&(this.__removeDropDownbutton(this.__logoutButton,this.__evtHandlerLogout),this.__logoutButton=this.__createDropDownButton(this.__evtHandlerLogout,"DropDown_Logout"),fragment.append(this.__logoutButton)),this.__allowSwitchUser&&(this.__removeDropDownbutton(this.__switchUserButton,this.__evtHandlerSwitchUser),this.__switchUserButton=this.__createDropDownButton(this.__evtHandlerSwitchUser,"Popup_SwitchUser"),fragment.append(this.__switchUserButton)),this.__showUsermanagementButtons.editUser&&(this.__removeDropDownbutton(this.__editUserButton,this.__evtHandlerEditUser),this.__editUserButton=this.__createDropDownButton(this.__evtHandlerEditUser,"DropDown_EditUser"),fragment.append(this.__editUserButton)),this.__showUsermanagementButtons.userManagement&&(this.__removeDropDownbutton(this.__userManagementButton,this.__evtHandlerUserManagement),this.__userManagementButton=this.__createDropDownButton(this.__evtHandlerUserManagement,"DropDown_UserManagement"),fragment.append(this.__userManagementButton)),this.__elementDropdown.textContent="",this.__elementDropdown.append(fragment)}__createDropDownButton(clickEventHandler,localizationKey){const passiveEventOptions={passive:!0,capture:!1};let buttonElement=document.createElement("div");return this.__addLocalizedElement(buttonElement,localizationKey),TcHmi.StyleProvider.processFontSize(buttonElement,this.__dropDownFontSize,this.__dropDownFontSizeUnit),buttonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-Dropdown-Element","tchmi-box"),buttonElement.addEventListener("mouseenter",this.__evtHandlerMouseEnter,passiveEventOptions),buttonElement.addEventListener("mouseleave",this.__evtHandlerMouseLeave,passiveEventOptions),buttonElement.addEventListener("touchcancel",this.__evtHandlerMouseLeave,passiveEventOptions),buttonElement.addEventListener("click",clickEventHandler,passiveEventOptions),buttonElement}__removeDropDownbutton(buttonElement,clickEventHandler){if(buttonElement){this.__removeLocalizedElement(buttonElement);const passiveEventOptions={passive:!0,capture:!1};buttonElement.removeEventListener("mouseenter",this.__evtHandlerMouseEnter,passiveEventOptions),buttonElement.removeEventListener("mouseleave",this.__evtHandlerMouseLeave,passiveEventOptions),buttonElement.removeEventListener("touchcancel",this.__evtHandlerMouseLeave,passiveEventOptions),buttonElement.removeEventListener("click",clickEventHandler,passiveEventOptions)}buttonElement=void 0}showSwitchUserPopup(){this.__switchUserPopup||(this.__switchUserPopup=new Beckhoff.TcHmiUserManagementPopups.SwitchUserPopup(this.__elementSwitchUserPopup,this)),this.__switchUserPopup.show()}showEditUserPopup(){this.__editUserPopup||(this.__editUserPopup=new Beckhoff.TcHmiUserManagementPopups.EditUserPopup(this.__elementEditUserPopup,this)),this.__editUserPopup.show()}showManageUserPopup(){this.__manageUserPopup||(this.__manageUserPopup=new Beckhoff.TcHmiUserManagementPopups.ManageUserPopup(this.__elementManageUserPopup,this)),this.__manageUserPopup.show()}__refreshPopupResources(){this.__switchUserPopup?.refreshParentControlResources(),this.__editUserPopup?.refreshParentControlResources(),this.__manageUserPopup?.refreshParentControlResources()}__onExpandDropdown(){return event=>{this.__setDropDownboxOpen()}}__onExpandDropdownMouseDown(){return event=>{this.__mouseDown=!0,this.__element[0].classList.add("down")}}__onExpandDropdownMouseLeave(){return event=>{this.__dropdownboxOpen||this.__element[0].classList.remove("down")}}__onExpandDropdownMouseEnter(){return event=>{!0===this.__mouseDown&&this.__element[0].classList.add("down")}}__onMouseUp(){return event=>{this.__mouseDown=!1,this.__element[0].classList.remove("down")}}__onLogout(){return event=>{TcHmi.TopMostLayer.remove(this,this.__elementDropdown),TcHmi.Server.logoutEx2(!0,null)}}__onSwitchUser(){return event=>{this.showSwitchUserPopup()}}__onEditUser(){return event=>{TcHmi.TopMostLayer.remove(this,this.__elementDropdown),this.showEditUserPopup()}}__onUserManagement(){return event=>{TcHmi.TopMostLayer.remove(this,this.__elementDropdown),this.showManageUserPopup()}}__onMouseEnter(){return event=>{this.__hoverComboboxItem(event.target,!0)}}__onMouseLeave(){return event=>{this.__hoverComboboxItem(event.target,!1)}}__onTouchstart(){return event=>{if(!this.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this,"operate"))return;let changedTouches=Array.prototype.slice.apply(event.changedTouches).filter((touch=>touch.target===event.target));0!==changedTouches.length&&(this.__touches=this.__touches.concat(changedTouches.map((touch=>({id:touch.identifier,originalX:touch.clientX,originalY:touch.clientY,element:touch.target})))),changedTouches.forEach((touch=>this.__hoverComboboxItem(touch.target,!0))))}}__onUserDataChanged(){return()=>{let userName=TcHmi.Server.getCurrentUser();if(null!==userName){if(this.__elementBase.innerText===userName)return;this.__elementBase.innerText=userName}else this.__elementBase.innerText="<unknown>";this.__switchUserPopup?.hide(),this.__switchUserPopup?.destroy(),this.__switchUserPopup=null,this.__editUserPopup?.hide(),this.__editUserPopup?.destroy(),this.__editUserPopup=null,this.__manageUserPopup?.hide(),this.__manageUserPopup?.destroy(),this.__manageUserPopup=null,this.__getApiAccessForDomains()}}__hoverComboboxItem(element,hover){element.classList.contains("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-Dropdown-Element")&&(hover?element.classList.add("hover"):this.__touches.some((touch=>touch.element===element))||element.classList.remove("hover"))}__getNotificationElement(){return this.__elementNotificationPopup}__getWarningElement(){return this.__elementWarningPopup}__getAddUserElement(){return this.__elementAddUserPopup}__getDeleteUserElement(){return this.__elementDeleteUserPopup}__getGroupmanagementElement(){return this.__elementChangeGroupsPopup}getAdvancedState(){return this.__advanced}setAdvancedState(valueNew){this.__advanced=valueNew}__addLocalizedElement(element,key,...parameters){let info={key:key};if(0!==parameters.length&&(info.parameters=parameters),this.__localizedElements.set(element,info),this.__localizationReader){let localizedText=this.__localizationReader.get(key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}__removeLocalizedElement(element){this.__localizedElements.delete(element)}getLocalization(){return this.__localization}setTextFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontSize")),convertedValue!==this.__textFontSize&&(this.__textFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontSize"}),this.__processTextFontSize())}getTextFontSize(){return this.__textFontSize}__processTextFontSize(){this.__refreshPopupResources()}setTextFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontSizeUnit")),convertedValue!==this.__textFontSizeUnit&&(this.__textFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontSizeUnit"}),this.__processTextFontSizeUnit())}getTextFontSizeUnit(){return this.__textFontSizeUnit}__processTextFontSizeUnit(){this.__processTextFontSize()}setHeadlineFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("HeadlineFontSize")),convertedValue!==this.__headlineFontSize&&(this.__headlineFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineFontSize"}),this.__processHeadlineFontSize())}getHeadlineFontSize(){return this.__headlineFontSize}__processHeadlineFontSize(){this.__refreshPopupResources()}setHeadlineFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("HeadlineFontSizeUnit")),convertedValue!==this.__headlineFontSizeUnit&&(this.__headlineFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineFontSizeUnit"}),this.__processHeadlineFontSizeUnit())}getHeadlineFontSizeUnit(){return this.__headlineFontSizeUnit}__processHeadlineFontSizeUnit(){this.__processHeadlineFontSize()}setSubHeadlineFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("SubHeadlineFontSize")),convertedValue!==this.__subHeadlineFontSize&&(this.__subHeadlineFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SubHeadlineFontSize"}),this.__procesSubHeadlineFontSize())}getSubHeadlineFontSize(){return this.__subHeadlineFontSize}__procesSubHeadlineFontSize(){this.__refreshPopupResources()}setSubHeadlineFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("SubHeadlineFontSizeUnit")),convertedValue!==this.__subHeadlineFontSizeUnit&&(this.__subHeadlineFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SubHeadlineFontSizeUnit"}),this.__processSubHeadlineFontSizeUnit())}getSubHeadlineFontSizeUnit(){return this.__subHeadlineFontSizeUnit}__processSubHeadlineFontSizeUnit(){this.__procesSubHeadlineFontSize()}setDropDownFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("DropDownFontSize")),convertedValue!==this.__dropDownFontSize&&(this.__dropDownFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"DropDownFontSize"}),this.__processDropDownFontSize())}getDropDownFontSize(){return this.__dropDownFontSize}__processDropDownFontSize(){this.__logoutButton&&TcHmi.StyleProvider.processFontSize(this.__logoutButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit),this.__switchUserButton&&TcHmi.StyleProvider.processFontSize(this.__switchUserButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit),this.__editUserButton&&TcHmi.StyleProvider.processFontSize(this.__editUserButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit),this.__userManagementButton&&TcHmi.StyleProvider.processFontSize(this.__userManagementButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit)}setDropDownFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("DropDownFontSizeUnit")),convertedValue!==this.__dropDownFontSizeUnit&&(this.__dropDownFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"DropDownFontSizeUnit"}),this.__processDropDownFontSizeUnit())}getDropDownFontSizeUnit(){return this.__dropDownFontSizeUnit}__processDropDownFontSizeUnit(){this.__processDropDownFontSize()}setUserNameFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("UserNameFontSize")),convertedValue!==this.__userNameFontSize&&(this.__userNameFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UserNameFontSize"}),this.__processUserNameFontSize())}getUserNameFontSize(){return this.__userNameFontSize}__processUserNameFontSize(){TcHmi.StyleProvider.processFontSize(this.__elementBase,this.__userNameFontSize,this.__userNameFontSizeUnit)}setUserNameFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("UserNameFontSizeUnit")),convertedValue!==this.__userNameFontSizeUnit&&(this.__userNameFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UserNameFontSizeUnit"}),this.__processUserNameFontSizeUnit())}getUserNameFontSizeUnit(){return this.__userNameFontSizeUnit}__processUserNameFontSizeUnit(){this.__processUserNameFontSize()}setTextColor(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextColor"));let resolverInfo=this.__objectResolvers.get("textColor");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,this);this.__objectResolvers.set("textColor",{resolver:resolver,watchCallback:this.__onResolverForTextColorWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForTextColorWatchCallback)})}getTextColor(){return this.__textColor}__processTextColor(){TcHmi.StyleProvider.processTextColor(this.__elementBase,this.__textColor)}setAllowLogout(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowLogout")),convertedValue!==this.__allowLogout&&(this.__allowLogout=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowLogout"}),this.__processAllowLogout())}getAllowLogout(){return this.__allowLogout}__processAllowLogout(){this.__getApiAccessForDomains()}setAllowSwitchUser(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowSwitchUser")),convertedValue!==this.__allowSwitchUser&&(this.__allowSwitchUser=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowSwitchUser"}),this.__processAllowSwitchUser())}getAllowSwitchUser(){return this.__allowSwitchUser}__processAllowSwitchUser(){this.__getApiAccessForDomains()}}Beckhoff.TcHmiUserManagement=TcHmiUserManagement}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiUserManagement","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiUserManagement),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){TcHmiUserManagementPopups.Popup=class{constructor(element,parentControl){if(this.__eventDestroyers=[],this.__isShowing=!1,this.__localizedElements=new Map,this.__localizationReader=void 0,this.__feedbackPrompt=null,this.__parentControl=parentControl,this.__localization=this.__parentControl.getLocalization(),this.__element=element,this.__elementHeadline=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-headline")[0],this.__elementContent=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-content")[0],this.__elementFooter=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-footer")[0],!(this.__element&&this.__elementContent&&this.__elementFooter&&this.__elementHeadline))throw new Error("Invalid Template.html");this.__eventDestroyers.push(this.__localization.watch((data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}})))}show(){this.__updateFontSizes(),this.__isShowing||(TcHmi.TopMostLayer.add(this.__parentControl,this.__element,{removeCb:data=>{this.__isShowing=!1,data.canceled&&this.hide()},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)}hide(){this.__isShowing&&(TcHmi.TopMostLayer.remove(this.__parentControl,this.__element),this.__isShowing=!1)}destroy(){if(this.__eventDestroyers&&this.__eventDestroyers.length>0)for(let e of this.__eventDestroyers)e();this.__eventDestroyers=[]}isShowing(){return this.__isShowing}setDomain(domain){this.__selectedDomain=domain}__addLocalizedElement(element,key,...parameters){let info={key:key};if(0!==parameters.length&&(info.parameters=parameters),this.__localizedElements.set(element,info),this.__localizationReader){let localizedText=this.__localizationReader.get(key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}__removeLocalizedElement(element){this.__localizedElements.delete(element)}__expandLocalizationSymbol(key){return`%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::${key}%/l%`}__updateFontSizes(){this.__textFontSize=this.__parentControl.getTextFontSize(),this.__textFontSizeUnit=this.__parentControl.getTextFontSizeUnit(),this.__headlineFontSize=this.__parentControl.getHeadlineFontSize(),this.__headlineFontSizeUnit=this.__parentControl.getHeadlineFontSizeUnit(),this.__subHeadlineFontSize=this.__parentControl.getSubHeadlineFontSize(),this.__subHeadlineFontSizeUnit=this.__parentControl.getSubHeadlineFontSizeUnit(),TcHmi.StyleProvider.processFontSize(this.__element,this.__textFontSize,this.__textFontSizeUnit),TcHmi.StyleProvider.processFontSize(this.__elementHeadline,this.__headlineFontSize,this.__headlineFontSizeUnit);let subHeadlines=this.__element.getElementsByTagName("h2");TcHmi.StyleProvider.processFontSize(subHeadlines,this.__subHeadlineFontSize,this.__subHeadlineFontSizeUnit)}refreshParentControlResources(){this.__updateFontSizes()}__createFeedbackPrompt(){return new Controls.Helpers.TextAndButtonsPrompt({ok:{value:void 0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("PopupButton_OK")}}},this.__parentControl)}}}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class EditUserPopup extends TcHmiUserManagementPopups.Popup{constructor(element,parentControl){if(super(element,parentControl),this.__groupList=[],this.__groupCheckboxes=new Map,this.__groupConfigurations=[],this.__groupCheckboxEventDestroyer=[],this.__evtHandlerGroupScroll=this.__onGroupScroll(),this.__elementPassword=this.__element.getElementsByClassName("content_2")[0],this.__elementGroups=this.__element.getElementsByClassName("content_3")[0],this.__elementLocale=this.__element.getElementsByClassName("content_4")[0],!this.__elementPassword||!this.__elementGroups||!this.__elementLocale)throw new Error("Invalid Template.html");this.__elementContentGroups=document.createElement("div"),this.__elementContentGroups.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-groups"),this.__elementContent.textContent="",this.__elementPassword.textContent="",this.__elementLocale.textContent="",void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CloseButton_EditUserPopup")&&(this.__closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".CloseButton_EditUserPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Close%/l%"},this.__parentControl),this.__closeButton&&(this.__closeButton.getElement()[0].classList.add("cancelbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CloseButton_EditUserPopup.onPressed",this.__onCloseUp())),this.__elementFooter.append(this.__closeButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".SaveButton_EditUserPopup")&&(this.__saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".SaveButton_EditUserPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Save%/l%"},this.__parentControl),this.__saveButton&&(this.__saveButton.getElement()[0].classList.add("confirmbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".SaveButton_EditUserPopup.onPressed",this.__onSaveUp())),this.__elementFooter.append(this.__saveButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".AdvancedToggleSwitch_EditUserPopup")&&(this.__advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",this.__parentControl.getId()+".AdvancedToggleSwitch_EditUserPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupToggleSwitch_Advanced%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupAdvancedToggleSwitchTooltip_EditUser%/l%"},this.__parentControl),this.__advancedSwitch&&(this.__advancedSwitch.getElement()[0].classList.add("advanced-switch"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".AdvancedToggleSwitch_EditUserPopup.onToggleStateChanged",this.__onAdvanced())),this.__elementFooter.append(this.__advancedSwitch.getElement()[0])));let username=TcHmi.Server.getCurrentUserConfig()?.name??"";this.__addLocalizedElement(this.__elementHeadline,"PopupHeadline_HelloName",username),this.__createPasswordTextboxes(),this.__createLocalizationSelection();this.__elementContentGroups.addEventListener("scroll",this.__evtHandlerGroupScroll,{passive:!0,capture:!1})}show(){super.show(),this.__groupConfigurations=TcHmi.Server.getCurrentUserConfig().userIsInGroups,this.__showControlsBasedOnApiAccess(),this.__setLocaleRadioButtonsByUserConfig(),this.__setGroupCheckboxesByUserConfig(),setTimeout((()=>{this.__setGroupScrollData()}),50)}destroy(){this.__saveButton?.destroy(),this.__saveButton=void 0,this.__closeButton?.destroy(),this.__closeButton=void 0,this.__advancedSwitch?.destroy(),this.__advancedSwitch=void 0,this.__oldPasswordInput?.destroy(),this.__oldPasswordInput=void 0,this.__newPasswordInput?.destroy(),this.__newPasswordInput=void 0,this.__newPasswordInput_2?.destroy(),this.__newPasswordInput_2=void 0,this.__localCombobox?.destroy(),this.__localCombobox=void 0,this.__radioButtonLocaleClient?.destroy(),this.__radioButtonLocaleClient=void 0,this.__radioButtonLocaleProject?.destroy(),this.__radioButtonLocaleProject=void 0,this.__radioButtonLocale?.destroy(),this.__radioButtonLocale=void 0,this.__timeZoneCombobox?.destroy(),this.__timeZoneCombobox=void 0,this.__radioButtonTimeZoneClient?.destroy(),this.__radioButtonTimeZoneClient=void 0,this.__radioButtonTimeZoneProjekt?.destroy(),this.__radioButtonTimeZoneProjekt=void 0,this.__radioButtonTimeZone?.destroy(),this.__radioButtonTimeZone=void 0,this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[];this.__elementContentGroups.removeEventListener("scroll",this.__evtHandlerGroupScroll,{passive:!0,capture:!1}),super.destroy()}__showControlsBasedOnApiAccess(){let domain=TcHmi.Server.getCurrentUserConfig().domain;domain&&TcHmi.Server.UserManagement.getApiAccess({domain:domain},(data=>{this.__apiAccessResult=data,data.error===TcHmi.Errors.NONE&&data.result&&(data.result.updateUser.changeOwnPassword?(data.result.updateUser.changePassword?this.__elementContent.classList.add("not-displayed"):this.__elementContent.classList.remove("not-displayed"),this.__elementPassword.classList.remove("not-displayed")):(this.__elementContent.classList.add("not-displayed"),this.__elementPassword.classList.add("not-displayed")),data.result.updateUser.addGroups&&data.result.updateUser.removeGroups&&data.result.listUserGroups.general?this.__parentControl.getAdvancedState()&&"Active"===this.__advancedSwitch?.getToggleState()||!this.__parentControl.getAdvancedState()&&"Active"!==this.__advancedSwitch?.getToggleState()?this.__createUserGroupSelection():this.__advancedSwitch?.setToggleState(this.__parentControl.getAdvancedState()?"Active":"Normal"):this.__elementGroups.classList.add("not-displayed"),data.result.updateUser.locale?this.__elementLocale.classList.remove("not-displayed"):this.__elementLocale.classList.add("not-displayed"),data.result.listUserGroups.general?this.__advancedSwitch?.setVisibility("Visible"):this.__advancedSwitch?.setVisibility("Collapsed"))}))}__createPasswordTextboxes(){let oldPassword=document.createElement("h2");oldPassword.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(oldPassword,"PopupHeadline_OldPassword"),this.__elementContent.append(oldPassword),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".PasswordTextbox_EditUserPopup")&&(this.__oldPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",this.__parentControl.getId()+".PasswordTextbox_EditUserPopup",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_OldPassword%/l%"},this.__parentControl),this.__oldPasswordInput&&this.__elementContent.append(this.__oldPasswordInput.getElement()[0]));let newPassword=document.createElement("h2");newPassword.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(newPassword,"PopupHeadline_NewPassword"),this.__elementPassword.append(newPassword),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".PasswordTextbox_2_EditUserPopup")&&(this.__newPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",this.__parentControl.getId()+".PasswordTextbox_2_EditUserPopup",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_NewPassword%/l%"},this.__parentControl),this.__newPasswordInput&&this.__elementPassword.append(this.__newPasswordInput.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".PasswordTextbox_3_EditUserPopup")&&(this.__newPasswordInput_2=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",this.__parentControl.getId()+".PasswordTextbox_3_EditUserPopup",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_RepeatNewPassword%/l%"},this.__parentControl),this.__newPasswordInput_2&&this.__elementPassword.append(this.__newPasswordInput_2.getElement()[0]))}__createUserGroupSelection(){TcHmi.Server.UserManagement.listUserGroups((data=>{(async()=>{if(data.error===TcHmi.Errors.NONE){if(data.groupDetailsList){let newGroupList=Object.keys(data.groupDetailsList);if("Normal"===this.__advancedSwitch?.getToggleState()&&(newGroupList=newGroupList.filter((group=>!group.startsWith("__")))),!tchmi_equal(this.__groupList,newGroupList)){this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],this.__elementGroups.textContent="";let userGroups=document.createElement("h2");userGroups.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(userGroups,"PopupHeadline_UserGroups"),this.__elementGroups.append(userGroups,this.__elementContentGroups),this.__groupList=newGroupList,this.__groupList.length>0?(this.__elementGroups.classList.remove("not-displayed"),this.__groupList.forEach((group=>{this.__createGroupCheckbox(group)})),this.__setGroupCheckboxesByUserConfig()):this.__elementGroups.classList.add("not-displayed")}}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserGroupError"),formatValues:[error,message]}}),await this.__feedbackPrompt.prompt(),this.hide(),this.__elementGroups.classList.add("not-displayed")}})()}))}__createGroupCheckbox(name){if(void 0===TcHmi.Controls.get(this.__parentControl.getId()+".UserGroupCheckbox_EditUser_Popup"+name)){let checkbox=TcHmi.ControlFactory.create("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__parentControl.getId()+".UserGroupCheckbox_EditUser_Popup"+name,this.__parentControl);checkbox&&(checkbox.setText(name),this.__groupCheckboxes.set(name,checkbox),this.__elementContentGroups.append(checkbox.getElement()[0]),this.__groupCheckboxEventDestroyer.push(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onGroupCheckbox(checkbox,name))))}}__onGroupCheckbox(checkbox,groupName){return()=>{"Normal"===checkbox.getToggleState()?this.__groupConfigurations=this.__groupConfigurations.filter((group=>group!==groupName)):this.__groupConfigurations.includes(groupName)||this.__groupConfigurations.push(groupName)}}__setGroupCheckboxesByUserConfig(){let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();this.__groupCheckboxes.forEach(((checkbox,group)=>{"__SystemGuest"===currentUserConfigurations.name&&"__SystemGuests"===group||"__SystemUser"===currentUserConfigurations.name&&"__SystemUsers"===group||"__SystemAdministrator"===currentUserConfigurations.name&&"__SystemAdministrators"===group?checkbox.setIsEnabled(!1):checkbox.setIsEnabled(!0),this.__groupConfigurations.includes(group)?checkbox.setToggleState("Active"):checkbox.setToggleState("Normal")})),this.__setGroupScrollData()}__createLocalizationSelection(){this.__elementLocale.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-content-radiobuttons");let localization=document.createElement("h2");localization.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(localization,"PopupHeadline_Localization"),this.__elementLocale.append(localization),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_Local_Projekt_EditUser_Popup")&&(this.__radioButtonLocaleProject=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_Local_Projekt_EditUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_ProjectDefault%/l%","data-tchmi-radio-group":"ToggleGroup_Locale_EditUserPopup"},this.__parentControl),this.__radioButtonLocaleProject&&this.__elementLocale.append(this.__radioButtonLocaleProject.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".Checkbox_Local_Client_EditUser_Popup")&&(this.__radioButtonLocaleClient=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_Local_Client_EditUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_BrowserDefault%/l%","data-tchmi-radio-group":"ToggleGroup_Locale_EditUserPopup","data-tchmi-radio-state":"Active"},this.__parentControl),this.__radioButtonLocaleClient&&this.__elementLocale.append(this.__radioButtonLocaleClient.getElement()[0]));let localeItem_Selection=document.createElement("div");if(localeItem_Selection.classList.add("combobox-selection"),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_Local_Selection_EditUserPopup")&&(this.__radioButtonLocale=TcHmi.ControlFactory.create("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_Local_Selection_EditUserPopup",this.__parentControl),this.__radioButtonLocale&&(this.__radioButtonLocale.setRadioGroup("ToggleGroup_Locale_EditUserPopup"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".RadioButton_Local_Selection_EditUserPopup.onRadioStateChanged",this.__onRadioStateChanged(!0))),localeItem_Selection.append(this.__radioButtonLocale.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CB_Local_EditUserPopup")&&(this.__localCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".CB_Local_EditUserPopup",{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__localCombobox)){this.__localCombobox.setIsEnabled(!1);let locales=TcHmi.Locale.getRegisteredLocales(),currentLocale=TcHmi.Locale.get();locales.sort(),this.__localCombobox.setSrcData(locales);for(let i=0;i<locales.length;i++){let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();currentUserConfigurations&&currentUserConfigurations.locale?locales[i].includes(currentUserConfigurations.locale)&&this.__localCombobox.setSelectedIndex(i):locales[i]===currentLocale&&this.__localCombobox.setSelectedIndex(i)}localeItem_Selection.append(this.__localCombobox.getElement()[0]),this.__localCombobox.getElement().find("polyline").css("stroke","")}this.__elementLocale.append(localeItem_Selection),this.__setLocaleRadioButtonsByUserConfig()}__setLocaleRadioButtonsByUserConfig(){let currentUserConfig=TcHmi.Server.getCurrentUserConfig();if(currentUserConfig?.configLocale&&"client"!==currentUserConfig?.configLocale){if("project"===currentUserConfig?.configLocale)this.__radioButtonLocaleProject&&this.__radioButtonLocaleProject.setRadioState("Active");else if(this.__localCombobox&&this.__radioButtonLocale){let registeredLocales=TcHmi.Locale.getRegisteredLocales();if(registeredLocales)for(let i=0,ii=registeredLocales.length;i<ii;i++)registeredLocales[i]===currentUserConfig?.configLocale&&(this.__radioButtonLocale.setRadioState("Active"),this.__localCombobox.setSelectedIndex(i))}}else this.__radioButtonLocaleClient&&this.__radioButtonLocaleClient.setRadioState("Active")}__createTimeZoneSelection(){let timeZone=document.createElement("h2");timeZone.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(timeZone,"PopupHeadline_TimeZone");let TimeZonelist_A=document.createElement("ul"),TimeZonelist_B=document.createElement("ul"),TimeZoneItem_Client=document.createElement("li"),TimeZoneItem_Projekt=document.createElement("li"),TimeZoneItem_Selection=document.createElement("li");TimeZoneItem_Selection.style.flexBasis="48px",TimeZoneItem_Selection.style.flexGrow="0";let TimeZoneItem_Combo=document.createElement("li");void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_TimeZone_Client_EditUser_Popup")&&(this.__radioButtonTimeZoneClient=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_TimeZone_Client_EditUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_BrowserDefault%/l%","data-tchmi-radio-group":"ToggleGroup_TimeZone_EditUserPopup"},this.__parentControl),this.__radioButtonTimeZoneClient&&TimeZoneItem_Client.append(this.__radioButtonTimeZoneClient.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_TimeZone_Projekt_EditUser_Popup")&&(this.__radioButtonTimeZoneProjekt=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_TimeZone_Projekt_EditUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_ProjectDefault%/l%","data-tchmi-radio-group":"ToggleGroup_TimeZone_EditUserPopup"},this.__parentControl),this.__radioButtonTimeZoneProjekt&&TimeZoneItem_Projekt.append(this.__radioButtonTimeZoneProjekt.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_TimeZone_Selection_EditUserPopup")&&(this.__radioButtonTimeZone=TcHmi.ControlFactory.create("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_TimeZone_Selection_EditUserPopup",this.__parentControl),this.__radioButtonTimeZone&&(this.__radioButtonTimeZone.setRadioGroup("ToggleGroup_TimeZone_EditUserPopup"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".RadioButton_TimeZone_Selection_EditUserPopup.onRadioStateChanged",this.__onRadioStateChanged(!1))),TimeZoneItem_Selection.append(this.__radioButtonTimeZone.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CB_Time_EditUserPopup")&&(this.__timeZoneCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".CB_Time_EditUserPopup",{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__timeZoneCombobox&&(this.__timeZoneCombobox.setIsEnabled(!1),TimeZoneItem_Combo.append(this.__timeZoneCombobox.getElement()[0]),this.__timeZoneCombobox.getElement().find("polyline").css("stroke",""))),TimeZonelist_A.append(TimeZoneItem_Projekt,TimeZoneItem_Client),TimeZonelist_B.append(TimeZoneItem_Selection,TimeZoneItem_Combo)}__checkLocaleRadioButtons(){let locale;return locale=this.__radioButtonLocaleClient&&"Active"===this.__radioButtonLocaleClient.getRadioState()?"client":this.__radioButtonLocaleProject&&"Active"===this.__radioButtonLocaleProject.getRadioState()?"project":this.__radioButtonLocale&&"Active"===this.__radioButtonLocale.getRadioState()&&this.__localCombobox?this.__localCombobox.getSelectedText():void 0,locale}__checkTimeZoneRadioButtons(){let timeZone;return timeZone=this.__radioButtonTimeZoneClient&&"Active"===this.__radioButtonTimeZoneClient.getRadioState()?"client":this.__radioButtonTimeZoneProjekt&&"Active"===this.__radioButtonTimeZoneProjekt.getRadioState()?"project":this.__radioButtonTimeZone&&"Active"===this.__radioButtonTimeZone.getRadioState()&&this.__timeZoneCombobox?this.__timeZoneCombobox.getSelectedText():void 0,timeZone}__onGroupScroll(){return e=>{this.__setGroupScrollData()}}__setGroupScrollData(){this.__elementContentGroups.clientHeight+this.__elementContentGroups.scrollTop===this.__elementContentGroups.scrollHeight?this.__elementContentGroups.dataset.scroll=0===this.__elementContentGroups.scrollTop?"none":"bottom":this.__elementContentGroups.dataset.scroll=0===this.__elementContentGroups.scrollTop?"top":"center"}__onRadioStateChanged(isLocale){return()=>{isLocale&&this.__radioButtonLocale&&this.__localCombobox&&("Active"===this.__radioButtonLocale.getRadioState()?this.__localCombobox.setIsEnabled(!0):this.__localCombobox.setIsEnabled(!1)),!isLocale&&this.__radioButtonTimeZone&&this.__timeZoneCombobox&&("Active"===this.__radioButtonTimeZone.getRadioState()?this.__timeZoneCombobox.setIsEnabled(!0):this.__timeZoneCombobox.setIsEnabled(!1))}}__onSaveUp(){return()=>{let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(this.__oldPasswordInput&&this.__newPasswordInput&&this.__newPasswordInput_2){let passwordOld=this.__oldPasswordInput.getText(),passwordNew=this.__newPasswordInput.getText(),passwordNew2=this.__newPasswordInput_2.getText();if(!passwordOld&&(passwordNew||passwordNew2)&&!this.__apiAccessResult?.result?.updateUser.changePassword)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_PasswordOld")}),void this.__feedbackPrompt.prompt();if(passwordOld||this.__apiAccessResult?.result?.updateUser.changePassword){if(!passwordNew||!passwordNew2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_BothPasswords")}),void this.__feedbackPrompt.prompt();if(passwordNew!==passwordNew2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_PasswordMatch")}),void this.__feedbackPrompt.prompt()}else passwordOld||passwordNew||passwordNew2||(passwordOld=void 0,passwordNew=void 0,passwordNew2=void 0);let groupsToAdd=[],groupsToRemove=[],locale=this.__checkLocaleRadioButtons(),timeZone=this.__checkTimeZoneRadioButtons();this.__groupCheckboxes&&this.__groupList&&currentUserConfigurations&&(groupsToRemove=currentUserConfigurations.userIsInGroups.filter((group=>"Normal"===this.__groupCheckboxes.get(group)?.getToggleState())),groupsToAdd=this.__groupList.filter((group=>"Active"===this.__groupCheckboxes.get(group)?.getToggleState()&&!currentUserConfigurations.userIsInGroups.includes(group)))),currentUserConfigurations&&currentUserConfigurations.name&&this.__updateUser(currentUserConfigurations.name,passwordOld,passwordNew,groupsToAdd,groupsToRemove,locale,timeZone)}}}__updateUser(username,oldPassword,newPassword,groupsToAdd,groupsToRemove,locale,timeZone){let updateData={};oldPassword&&(updateData.currentPassword=oldPassword),newPassword&&(updateData.password=newPassword),groupsToAdd&&groupsToAdd.length>0&&(updateData.addGroups=groupsToAdd),groupsToRemove&&groupsToRemove.length>0&&(updateData.removeGroups=groupsToRemove),locale&&(updateData.locale=locale),timeZone&&(updateData.timeZone=timeZone),updateData.domain=TcHmi.Server.getCurrentUserConfig().domain??TcHmi.Server.getCurrentUserConfig().defaultAuthExtension,username&&updateData&&TcHmi.Server.UserManagement.updateUser(username,updateData,(data=>{if(data.error===TcHmi.Errors.NONE)this.__showControlsBasedOnApiAccess(),this.__parentControl.updateDropdown();else{let error=data.error,message="",reason="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")"),data.details.errors[0].reason&&(reason=data.details.errors[0].reason)),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_UserInfoNotUpdated"),formatValues:[error,message,reason,username]}}),this.__feedbackPrompt.prompt()}}))}__onAdvanced(){return()=>{this.__createUserGroupSelection(),this.__parentControl.setAdvancedState("Active"===this.__advancedSwitch?.getToggleState())}}__resetControls(){this.__oldPasswordInput?.setText(""),this.__newPasswordInput?.setText(""),this.__newPasswordInput_2?.setText(""),this.__radioButtonLocaleClient?.setRadioState("Active")}__onCloseUp(){return()=>{this.__resetControls(),this.hide()}}__updateFontSizes(){super.__updateFontSizes(),this.__localCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__localCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null),this.__timeZoneCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__timeZoneCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null)}}TcHmiUserManagementPopups.EditUserPopup=EditUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class ManageUserPopup extends TcHmiUserManagementPopups.Popup{constructor(element,parentControl){super(element,parentControl);let username=TcHmi.Server.getCurrentUser();if(username&&this.__addLocalizedElement(this.__elementHeadline,"PopupHeadline_HelloName",username),this.__elementButtons=this.__element.getElementsByClassName("content_2")[0],this.__domainHeadline=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-headline-2")[0],!this.__elementButtons||!this.__domainHeadline)throw new Error("Invalid Template.html");this.__addLocalizedElement(this.__domainHeadline,"PopupHeadline_Domain"),this.__elementFeedback=document.createElement("div"),this.__addLocalizedElement(this.__elementFeedback,"PopupFeedback_NothingToConfigure"),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CloseButton-UserManagement")&&(this.__closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".CloseButton-UserManagement",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Close%/l%"},this.__parentControl),this.__closeButton&&(this.__closeButton.getElement()[0].classList.add("confirmbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CloseButton-UserManagement.onPressed",this.__onClose())),this.__elementFooter.append(this.__closeButton.getElement()[0]))),this.__createButtons(),this.__elementButtons.append(this.__elementFeedback)}show(){super.show(),this.updateDomains()}destroy(){super.destroy(),this.__closeButton?.destroy(),this.__closeButton=void 0,this.__addUserButton?.destroy(),this.__addUserButton=void 0,this.__deleteUserButton?.destroy(),this.__deleteUserButton=void 0,this.__domainCombobox?.destroy(),this.__domainCombobox=void 0,this.__manageUserGroupsButton?.destroy(),this.__manageUserGroupsButton=void 0,this.__addUserPopup?.hide(),this.__addUserPopup?.destroy(),this.__addUserPopup=void 0,this.__deleteUserPopup?.hide(),this.__deleteUserPopup?.destroy(),this.__deleteUserPopup=void 0,this.__changeUserPopup?.hide(),this.__changeUserPopup?.destroy(),this.__changeUserPopup=void 0}updateDomains(){TcHmi.Server.readSymbol("ListDomains",(data=>{const domainList=data.response?.commands?.[0].readValue;if(data.error===TcHmi.Errors.NONE&&domainList){const domains=[];for(let[domainName,domain]of Object.entries(domainList))domain?.authExtension&&domains.push(domainName);if(domains.length<1)this.__elementContent.classList.add("not-displayed"),this.__selectedDomain=TcHmi.Server.getCurrentUserConfig().defaultAuthExtension,this.__showButtonsBasedOnApiAccess();else if(1===domains.length)this.__selectedDomain=domains[0],this.__elementContent.classList.add("not-displayed"),this.__showButtonsBasedOnApiAccess();else{this.__createDomainCombobox(),this.__elementContent.classList.remove("not-displayed");let currentDomain=this.__selectedDomain??TcHmi.Server.getCurrentUserConfig().domain;if(this.__domainCombobox){this.__domainCombobox.setSrcData(domains);let index=domains.findIndex((x=>x===currentDomain));-1===index&&(index=0),this.__domainCombobox.setSelectedIndex(index)}}this.__showButtonsBasedOnApiAccess()}}))}__createDomainCombobox(){this.__domainCombobox=TcHmi.Controls.get(this.__parentControl.getId()+".DomainCombobox-UserManagement"),this.__domainCombobox||(this.__domainCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".DomainCombobox-UserManagement",{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__domainCombobox&&(this.__elementContent.append(this.__domainCombobox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".DomainCombobox-UserManagement.onSelectionChanged",this.__onDomainSelectionChanged()))))}__showButtonsBasedOnApiAccess(){this.__selectedDomain&&TcHmi.Server.UserManagement.getApiAccess({domain:this.__selectedDomain},(data=>{if(data.error===TcHmi.Errors.NONE&&data.result){let showFeedback=!0;data.result.addUser.general&&data.result.listUserGroups.general&&data.result.listUsers.general?(this.__addUserButton?.getElement()[0].classList.remove("not-displayed"),showFeedback=!1):this.__addUserButton?.getElement()[0].classList.add("not-displayed"),data.result.listUsers.general&&data.result.listUsers.groups&&data.result.listUserGroups.general&&data.result.updateUser.removeGroups&&data.result.updateUser.addGroups?(this.__manageUserGroupsButton?.getElement()[0].classList.remove("not-displayed"),showFeedback=!1):this.__manageUserGroupsButton?.getElement()[0].classList.add("not-displayed"),data.result.listUsers.general&&data.result.removeUser.general?(this.__deleteUserButton?.getElement()[0].classList.remove("not-displayed"),showFeedback=!1):this.__deleteUserButton?.getElement()[0].classList.add("not-displayed"),this.__elementFeedback.classList.toggle("not-displayed",!showFeedback)}else this.__elementFeedback.classList.remove("not-displayed"),this.__addUserButton?.getElement()[0].classList.add("not-displayed"),this.__manageUserGroupsButton?.getElement()[0].classList.add("not-displayed"),this.__deleteUserButton?.getElement()[0].classList.add("not-displayed")}))}__createButtons(){void 0===TcHmi.Controls.get(this.__parentControl.getId()+".AddUserButton-UserManagement")&&(this.__addUserButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".AddUserButton-UserManagement",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::Popup_AddUser%/l%"},this.__parentControl),this.__addUserButton&&(this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".AddUserButton-UserManagement.onPressed",this.__onAddUser())),this.__elementButtons.append(this.__addUserButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".DeleteUserButton-UserManagement")&&(this.__deleteUserButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".DeleteUserButton-UserManagement",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::Popup_DeleteUser%/l%"},this.__parentControl),this.__deleteUserButton&&(this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".DeleteUserButton-UserManagement.onPressed",this.__onDeleteUser())),this.__elementButtons.append(this.__deleteUserButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".ManageUserGroupsButton-UserManagement")&&(this.__manageUserGroupsButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".ManageUserGroupsButton-UserManagement",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::Popup_ChangeUsers%/l%"},this.__parentControl),this.__manageUserGroupsButton&&(this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".ManageUserGroupsButton-UserManagement.onPressed",this.__onChangeUser())),this.__elementButtons.append(this.__manageUserGroupsButton.getElement()[0])))}__onClose(){return()=>{this.hide()}}__onAddUser(){return()=>{this.__addUserPopup||(this.__addUserPopup=new TcHmiUserManagementPopups.AddUserPopup(this.__parentControl.__getAddUserElement(),this.__parentControl)),this.__addUserPopup.setDomain(this.__selectedDomain),this.__addUserPopup.show()}}__onDeleteUser(){return()=>{this.__deleteUserPopup||(this.__deleteUserPopup=new TcHmiUserManagementPopups.DeleteUserPopup(this.__parentControl.__getDeleteUserElement(),this.__parentControl)),this.__deleteUserPopup.setDomain(this.__selectedDomain),this.__deleteUserPopup.show()}}__onChangeUser(){return()=>{this.__changeUserPopup||(this.__changeUserPopup=new TcHmiUserManagementPopups.ChangeUserPopup(this.__parentControl.__getGroupmanagementElement(),this.__parentControl,this)),this.__changeUserPopup.setDomain(this.__selectedDomain),this.__changeUserPopup.show()}}__onDomainSelectionChanged(){return()=>{this.__selectedDomain=this.__domainCombobox?.getSelectedValue(),this.__showButtonsBasedOnApiAccess()}}refreshParentControlResources(){super.refreshParentControlResources(),this.__addUserPopup?.refreshParentControlResources(),this.__deleteUserPopup?.refreshParentControlResources(),this.__changeUserPopup?.refreshParentControlResources()}__updateFontSizes(){super.__updateFontSizes(),this.__domainCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__domainCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null)}}TcHmiUserManagementPopups.ManageUserPopup=ManageUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class AddUserPopup extends TcHmiUserManagementPopups.Popup{constructor(element,parentControl){if(super(element,parentControl),this.__groupList=[],this.__groupCheckboxes=new Map,this.__groupConfigurations=[],this.__groupCheckboxEventDestroyer=[],this.__evtHandlerGroupScroll=this.__onGroupScroll(),this.__elementPassword=this.__element.getElementsByClassName("content_2")[0],this.__elementGroups=this.__element.getElementsByClassName("content_3")[0],this.__elementLocale=this.__element.getElementsByClassName("content_4")[0],this.__elementContentGroups=document.createElement("div"),this.__elementContentGroups.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-groups"),!(this.__elementPassword&&this.__elementGroups&&this.__elementLocale&&this.__elementContentGroups))throw new Error("Invalid Template.html");this.__elementContent.textContent="",this.__elementPassword.textContent="",this.__elementLocale.textContent="",void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CloseButton_AddUserPopup")&&(this.__closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".CloseButton_AddUserPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Close%/l%"},this.__parentControl),this.__closeButton&&(this.__closeButton.getElement()[0].classList.add("cancelbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CloseButton_AddUserPopup.onPressed",this.__onCloseUp())),this.__elementFooter.append(this.__closeButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".SaveButton_AddUserPopup")&&(this.__saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".SaveButton_AddUserPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Save%/l%"},this.__parentControl),this.__saveButton&&(this.__saveButton.getElement()[0].classList.add("confirmbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".SaveButton_AddUserPopup.onPressed",this.__onSaveUp())),this.__elementFooter.append(this.__saveButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".AdvancedToggleSwitch_AddUserPopup")&&(this.__advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",this.__parentControl.getId()+".AdvancedToggleSwitch_AddUserPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupToggleSwitch_Advanced%/l%"},this.__parentControl),this.__advancedSwitch&&(this.__advancedSwitch.getElement()[0].classList.add("advanced-switch"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".AdvancedToggleSwitch_AddUserPopup.onToggleStateChanged",this.__onAdvanced())),this.__elementFooter.append(this.__advancedSwitch.getElement()[0]))),this.__addLocalizedElement(this.__elementHeadline,"Popup_AddUser"),this.__createUserNameInput(),this.__createNewPasswordInput(),this.__createLocalizationSelection();this.__elementContentGroups.addEventListener("scroll",this.__evtHandlerGroupScroll,{passive:!0,capture:!1});let currentUserConfig=TcHmi.Server.getCurrentUserConfig();this.__groupConfigurations.push(currentUserConfig.defaultUserGroup??"__SystemUsers")}show(){super.show(),this.__showControlsBasedOnApiAccess(),this.__advancedSwitch?.setToggleState(this.__parentControl.getAdvancedState()?"Active":"Normal"),setTimeout((()=>{this.__setGroupScrollData()}),50)}destroy(){this.__saveButton?.destroy(),this.__saveButton=void 0,this.__closeButton?.destroy(),this.__closeButton=void 0,this.__advancedSwitch?.destroy(),this.__advancedSwitch=void 0,this.__userNameInput?.destroy(),this.__userNameInput=void 0,this.__newPasswordInput?.destroy(),this.__newPasswordInput=void 0,this.__newPasswordInput_2?.destroy(),this.__newPasswordInput_2=void 0,this.__localCombobox?.destroy(),this.__localCombobox=void 0,this.__radioButtonLocaleClient?.destroy(),this.__radioButtonLocaleClient=void 0,this.__radioButtonLocaleProject?.destroy(),this.__radioButtonLocaleProject=void 0,this.__radioButtonLocale?.destroy(),this.__radioButtonLocale=void 0,this.__timeZoneCombobox?.destroy(),this.__timeZoneCombobox=void 0,this.__radioButtonTimeZoneClient?.destroy(),this.__radioButtonTimeZoneClient=void 0,this.__radioButtonTimeZoneProjekt?.destroy(),this.__radioButtonTimeZoneProjekt=void 0,this.__radioButtonTimeZone?.destroy(),this.__radioButtonTimeZone=void 0,this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[];this.__elementContentGroups.removeEventListener("scroll",this.__evtHandlerGroupScroll,{passive:!0,capture:!1}),super.destroy()}__showControlsBasedOnApiAccess(){TcHmi.Server.UserManagement.getApiAccess({domain:this.__selectedDomain},(data=>{data.error===TcHmi.Errors.NONE&&data.result&&(data.result.addUser.general?(this.__elementContent.classList.remove("not-displayed"),this.__elementPassword.classList.remove("not-displayed")):(this.__elementContent.classList.add("not-displayed"),this.__elementPassword.classList.remove("not-displayed")),data.result.addUser.groups&&data.result.listUserGroups.general?this.__createUserGroupSelection():this.__elementGroups.classList.add("not-displayed"),data.result.addUser.locale?this.__elementLocale.classList.remove("not-displayed"):this.__elementLocale.classList.add("not-displayed"))}))}__createUserNameInput(){let username=document.createElement("h2");username.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(username,"PopupHeadline_UserName"),this.__elementContent.append(username),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".UserTextbox_Popup_UM")&&(this.__userNameInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput",this.__parentControl.getId()+".UserTextbox_Popup_UM",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_EnterUsername%/l%"},this.__parentControl),this.__userNameInput&&this.__elementContent.append(this.__userNameInput.getElement()[0]))}__createNewPasswordInput(){let password=document.createElement("h2");password.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(password,"PopupHeadline_Password"),this.__elementPassword.append(password),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".PasswordTextbox_Popup_UM")&&(this.__newPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",this.__parentControl.getId()+".PasswordTextbox_Popup_UM",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_NewPassword%/l%"},this.__parentControl),this.__newPasswordInput&&this.__elementPassword.append(this.__newPasswordInput.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".PasswordTextbox_Popup_2_UM")&&(this.__newPasswordInput_2=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",this.__parentControl.getId()+".PasswordTextbox_2_Popup_UM",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_RepeatNewPassword%/l%"},this.__parentControl),this.__newPasswordInput_2&&this.__elementPassword.append(this.__newPasswordInput_2.getElement()[0]))}__createUserGroupSelection(){TcHmi.Server.UserManagement.listUserGroups((data=>{if(data.error===TcHmi.Errors.NONE){if(data.groupDetailsList){let newGroupList=Object.keys(data.groupDetailsList);if("Normal"===this.__advancedSwitch?.getToggleState()&&(newGroupList=newGroupList.filter((group=>!group.startsWith("__")))),!tchmi_equal(this.__groupList,newGroupList)){this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],this.__elementGroups.textContent="";let userGroups=document.createElement("h2");userGroups.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(userGroups,"PopupHeadline_UserGroups"),this.__elementGroups.append(userGroups,this.__elementContentGroups),this.__groupList=newGroupList,this.__groupList.length>0?(this.__elementGroups.classList.remove("not-displayed"),this.__groupList.forEach((group=>{this.__createGroupCheckbox(group)})),this.__groupConfigurations.forEach((group=>{this.__groupCheckboxes.get(group)?.setToggleState("Active")}))):this.__elementGroups.classList.add("not-displayed"),this.__setGroupScrollData()}}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserGroupError"),formatValues:[error,message]}}),this.__feedbackPrompt.prompt(),this.__elementGroups.classList.add("not-displayed")}}))}__createGroupCheckbox(name){if(void 0===TcHmi.Controls.get(this.__parentControl.getId()+".UserGroupCheckbox_AddUser_Popup"+name)){let checkbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__parentControl.getId()+".UserGroupCheckbox_AddUser_Popup"+name,{"data-tchmi-text":name,"data-tchmi-toggle-state":"Normal"},this.__parentControl);checkbox&&(this.__groupCheckboxes?.set(name,checkbox),this.__elementContentGroups.append(checkbox.getElement()[0]),this.__groupCheckboxEventDestroyer.push(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onGroupCheckbox(checkbox,name))))}}__onGroupCheckbox(checkbox,groupName){return()=>{"Normal"===checkbox.getToggleState()?this.__groupConfigurations=this.__groupConfigurations.filter((group=>group!==groupName)):this.__groupConfigurations.includes(groupName)||this.__groupConfigurations.push(groupName)}}__createLocalizationSelection(){this.__elementLocale.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-content-radiobuttons");let localization=document.createElement("h2");localization.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(localization,"PopupHeadline_Localization"),this.__elementLocale.append(localization),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_Local_Projekt_AddUser_Popup")&&(this.__radioButtonLocaleProject=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_Local_Projekt_AddUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_ProjectDefault%/l%","data-tchmi-radio-group":"ToggleGroup_Locale_AddUser_Popup"},this.__parentControl),this.__radioButtonLocaleProject&&this.__elementLocale.append(this.__radioButtonLocaleProject.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".Checkbox_Local_Client_AddUser_Popup")&&(this.__radioButtonLocaleClient=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_Local_Client_AddUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_BrowserDefault%/l%","data-tchmi-radio-group":"ToggleGroup_Locale_AddUser_Popup","data-tchmi-radio-state":"Active"},this.__parentControl),this.__radioButtonLocaleClient&&this.__elementLocale.append(this.__radioButtonLocaleClient.getElement()[0]));let localeItem_Selection=document.createElement("div");if(localeItem_Selection.classList.add("combobox-selection"),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_Local_Selection_AddUser_Popup")&&(this.__radioButtonLocale=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_Local_Selection_AddUser_Popup",{"data-tchmi-radio-group":"ToggleGroup_Locale_AddUser_Popup"},this.__parentControl),this.__radioButtonLocale&&(this.__radioButtonLocale.setRadioGroup("ToggleGroup_Locale_AddUser_Popup"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".RadioButton_Local_Selection_AddUser_Popup.onRadioStateChanged",this.__onRadioStateChanged(!0))),localeItem_Selection.append(this.__radioButtonLocale.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CB_Local_AddUser_Popup")&&(this.__localCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".CB_Local_AddUser_Popup",{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__localCombobox)){this.__localCombobox.setIsEnabled(!1);let locales=TcHmi.Locale.getRegisteredLocales();locales.sort();let currentLocale=TcHmi.Locale.get();this.__localCombobox.setSrcData(locales);for(let i=0;i<locales.length;i++){let userConfig=TcHmi.Server.getCurrentUserConfig();userConfig&&userConfig.locale?locales[i].includes(userConfig.locale)&&this.__localCombobox.setSelectedIndex(i):locales[i]===currentLocale&&this.__localCombobox.setSelectedIndex(i)}localeItem_Selection.append(this.__localCombobox.getElement()[0]),this.__localCombobox.getElement().find("polyline").css("stroke","")}this.__elementLocale.append(localeItem_Selection)}__createTimeZoneSelection(){let timeZone=document.createElement("h2");timeZone.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(timeZone,"PopupHeadline_TimeZone");let TimeZonelist_A=document.createElement("ul"),TimeZonelist_B=document.createElement("ul"),TimeZoneItem_Client=document.createElement("li"),TimeZoneItem_Projekt=document.createElement("li"),TimeZoneItem_Selection=document.createElement("li");TimeZoneItem_Selection.style.flexBasis="48px",TimeZoneItem_Selection.style.flexGrow="0";let TimeZoneItem_Combo=document.createElement("li");void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_TimeZone_Client_AddUser_Popup")&&(this.__radioButtonTimeZoneClient=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_TimeZone_Client_AddUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_BrowserDefault%/l%","data-tchmi-radio-group":"ToggleGroup_TimeZone_AddUser_Popup"},this.__parentControl),this.__radioButtonTimeZoneClient&&TimeZoneItem_Client.append(this.__radioButtonTimeZoneClient.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_TimeZone_Projekt_AddUser_Popup")&&(this.__radioButtonTimeZoneProjekt=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_TimeZone_Projekt_AddUser_Popup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupRadioChoice_ProjectDefault%/l%","data-tchmi-radio-group":"ToggleGroup_TimeZone_AddUser_Popup"},this.__parentControl),this.__radioButtonTimeZoneProjekt&&TimeZoneItem_Projekt.append(this.__radioButtonTimeZoneProjekt.getElement()[0])),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".RadioButton_TimeZone_Selection_AddUser_Popup")&&(this.__radioButtonTimeZone=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",this.__parentControl.getId()+".RadioButton_TimeZone_Selection_AddUser_Popup",{"data-tchmi-radio-group":"ToggleGroup_TimeZone_AddUser_Popup"},this.__parentControl),this.__radioButtonTimeZone&&(this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".RadioButton_TimeZone_Selection_AddUser_Popup.onRadioStateChanged",this.__onRadioStateChanged(!1))),TimeZoneItem_Selection.append(this.__radioButtonTimeZone.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CB_Time_AddUser_Popup")&&(this.__timeZoneCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".CB_Time_AddUser_Popup",{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__timeZoneCombobox&&(this.__timeZoneCombobox.setIsEnabled(!1),TimeZoneItem_Combo.append(this.__timeZoneCombobox.getElement()[0]),this.__timeZoneCombobox.getElement().find("polyline").css("stroke",""))),TimeZonelist_A.append(TimeZoneItem_Projekt,TimeZoneItem_Client),TimeZonelist_B.append(TimeZoneItem_Selection,TimeZoneItem_Combo)}__checkLocaleRadioButtons(){let locale,userconfig=TcHmi.Server.getCurrentUserConfig();return locale=userconfig?userconfig.locale:"client",locale=this.__radioButtonLocaleClient&&"Active"===this.__radioButtonLocaleClient.getRadioState()?"client":this.__radioButtonLocaleProject&&"Active"===this.__radioButtonLocaleProject.getRadioState()?"project":this.__radioButtonLocale&&"Active"===this.__radioButtonLocale.getRadioState()&&this.__localCombobox?this.__localCombobox.getSelectedText():void 0,locale}__checkTimeZoneRadioButtons(){let timeZone,userconfig=TcHmi.Server.getCurrentUserConfig();return timeZone=userconfig?userconfig.timeZone:"client",this.__radioButtonTimeZoneClient&&"Active"===this.__radioButtonTimeZoneClient.getRadioState()?timeZone="client":this.__radioButtonTimeZoneProjekt&&"Active"===this.__radioButtonTimeZoneProjekt.getRadioState()?timeZone="project":this.__radioButtonTimeZone&&"Active"===this.__radioButtonTimeZone.getRadioState()&&this.__timeZoneCombobox&&(timeZone=this.__timeZoneCombobox.getSelectedText()),timeZone}__onGroupScroll(){return e=>{this.__setGroupScrollData()}}__setGroupScrollData(){this.__elementContentGroups.clientHeight+this.__elementContentGroups.scrollTop===this.__elementContentGroups.scrollHeight?this.__elementContentGroups.dataset.scroll=0===this.__elementContentGroups.scrollTop?"none":"bottom":this.__elementContentGroups.dataset.scroll=0===this.__elementContentGroups.scrollTop?"top":"center"}__onRadioStateChanged(isLocale){return()=>{isLocale&&this.__radioButtonLocale&&this.__localCombobox&&("Active"===this.__radioButtonLocale.getRadioState()?this.__localCombobox.setIsEnabled(!0):this.__localCombobox.setIsEnabled(!1)),!isLocale&&this.__radioButtonTimeZone&&this.__timeZoneCombobox&&("Active"===this.__radioButtonTimeZone.getRadioState()?this.__timeZoneCombobox.setIsEnabled(!0):this.__timeZoneCombobox.setIsEnabled(!1))}}__onAdvanced(){return()=>{this.__createUserGroupSelection(),this.__parentControl.setAdvancedState("Active"===this.__advancedSwitch?.getToggleState())}}__onSaveUp(){return()=>{if(this.__userNameInput&&this.__newPasswordInput&&this.__newPasswordInput_2){const username=this.__userNameInput.getText(),password1=this.__newPasswordInput.getText(),password2=this.__newPasswordInput_2.getText();if(!username)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_EnterUsername")}),void this.__feedbackPrompt.prompt();if(!password1||""===password1||!password2||""===password2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_BothPasswords")}),void this.__feedbackPrompt.prompt();if(password1!==password2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_PasswordMatch")}),void this.__feedbackPrompt.prompt();{let groupsToAdd=this.__groupConfigurations;if(0===groupsToAdd.length)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_Usergroup")}),void this.__feedbackPrompt.prompt();let locale=this.__checkLocaleRadioButtons(),timeZone=this.__checkTimeZoneRadioButtons();TcHmi.Server.UserManagement.listUsersEx({domain:this.__selectedDomain},null,(data=>{if(data.error===TcHmi.Errors.NONE){if(data.userDetails){let keys=Object.keys(data.userDetails);for(let name of keys)if(name===username)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupFeedback_UsernameExists"),formatValues:[username]}}),void this.__feedbackPrompt.prompt()}TcHmi.Server.UserManagement.addUserEx(username,password1,{groups:groupsToAdd,locale:locale,timeZone:timeZone,domain:this.__selectedDomain},{timeout:2e3},(data=>{if(data.error!==TcHmi.Errors.NONE){let error=data.error,message="";return data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_UserAddedError"),formatValues:[error,message]}}),void this.__feedbackPrompt.prompt()}this.__resetControls(),this.hide()}))}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserError"),formatValues:[error,message]}}),this.__feedbackPrompt.prompt()}}))}}}}__resetControls(){this.__userNameInput?.setText(""),this.__newPasswordInput?.setText(""),this.__newPasswordInput_2?.setText(""),this.__radioButtonLocaleClient?.setRadioState("Active");let currentUserConfig=TcHmi.Server.getCurrentUserConfig();this.__groupConfigurations=[currentUserConfig.defaultUserGroup],this.__groupCheckboxes.forEach(((checkbox,group)=>{"__SystemUsers"===group?checkbox.setToggleState("Active"):checkbox.setToggleState("Normal")}))}__onCloseUp(){return()=>{this.__resetControls(),this.hide()}}__updateFontSizes(){super.__updateFontSizes(),this.__localCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__localCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null),this.__timeZoneCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__timeZoneCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null)}}TcHmiUserManagementPopups.AddUserPopup=AddUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class DeleteUserPopup extends TcHmiUserManagementPopups.Popup{constructor(element,parentControl){super(element,parentControl),this.__deleteConfirmationPrompt=null,this.__addLocalizedElement(this.__elementHeadline,"Popup_DeleteUser"),this.__elementContent.textContent="",void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CloseButton_DeleteUser")&&(this.__closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".CloseButton_DeleteUser",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Close%/l%"},this.__parentControl),this.__closeButton&&(this.__closeButton.getElement()[0].classList.add("cancelbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CloseButton_DeleteUser.onPressed",this.__onCancel())),this.__elementFooter.append(this.__closeButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".ConfirmButton_DeleteUser")&&(this.__confirmButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".ConfirmButton_DeleteUser",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Delete%/l%"},this.__parentControl),this.__confirmButton&&(this.__confirmButton.getElement()[0].classList.add("confirmbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".ConfirmButton_DeleteUser.onPressed",this.__onConfirm())),this.__elementFooter.append(this.__confirmButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".AdvancedToggleSwitch_DeleteUser")&&(this.__advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",this.__parentControl.getId()+".AdvancedToggleSwitch_DeleteUser",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupToggleSwitch_Advanced%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupAdvancedToggleSwitchTooltip_DeleteUser%/l%"},this.__parentControl),this.__advancedSwitch&&(this.__advancedSwitch.getElement()[0].classList.add("advanced-switch"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".AdvancedToggleSwitch_DeleteUser.onToggleStateChanged",this.__onAdvanced())),this.__elementFooter.append(this.__advancedSwitch.getElement()[0]))),this.__createUserSelectionCombobox()}show(){super.show(),this.__updateComboboxData(),this.__advancedSwitch?.setToggleState(this.__parentControl.getAdvancedState()?"Active":"Normal")}destroy(){super.destroy(),this.__confirmButton?.destroy(),this.__confirmButton=void 0,this.__closeButton?.destroy(),this.__closeButton=void 0,this.__advancedSwitch?.destroy(),this.__advancedSwitch=void 0,this.__userCombobox?.destroy(),this.__userCombobox=void 0}__createUserSelectionCombobox(){let username=document.createElement("h2");username.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(username,"PopupHeadline_SelectUser"),this.__elementContent.append(username),TcHmi.Server.UserManagement.listUsersEx({domain:this.__selectedDomain},null,(data=>{(async()=>{if(data.error===TcHmi.Errors.NONE){if(data.userDetails&&void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CB_UserSelection_DeleteUser_Popup")&&(this.__userCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".CB_UserSelection_DeleteUser_Popup",{"data-tchmi-combobox-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_SelectAUser%/l%","data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__userCombobox)){let userList=Object.keys(data.userDetails);"Normal"===this.__advancedSwitch?.getToggleState()&&(userList=userList.filter((user=>!user.startsWith("__"))));let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(currentUserConfigurations?.name){let userIndex=userList.indexOf(currentUserConfigurations.name);-1!==userIndex&&userList.splice(userIndex,1)}this.__userCombobox.setSrcData(userList),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CB_UserSelection_DeleteUser_Popup.onSelectionChanged",this.__onUserCombobox())),this.__elementContent.append(this.__userCombobox.getElement()[0]),this.__userCombobox.getElement().find("polyline").css("stroke","")}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserError"),formatValues:[error,message]}}),await this.__feedbackPrompt.prompt(),this.hide()}})()}))}__updateComboboxData(){let currentSelection=this.__userCombobox?.getSelectedText();TcHmi.Server.UserManagement.listUsersEx({domain:this.__selectedDomain},null,(data=>{if(data.error===TcHmi.Errors.NONE){if(data.userDetails){let userList=Object.keys(data.userDetails);"Normal"===this.__advancedSwitch?.getToggleState()&&(userList=userList.filter((user=>!user.startsWith("__"))));let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(currentUserConfigurations?.name){let userIndex=userList.indexOf(currentUserConfigurations.name);-1!==userIndex&&userList.splice(userIndex,1)}this.__userCombobox&&this.__userCombobox.setSrcData(userList)}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserError"),formatValues:[error,message]}}),this.__feedbackPrompt.prompt()}let srcData=this.__userCombobox?.getSrcData();if(srcData?.length>0&&currentSelection){let index=srcData?.indexOf(currentSelection);-1!==index?this.__userCombobox?.setSelectedIndex(index):this.__userCombobox?.setSelectedIndex(0)}else this.__userCombobox?.setSelectedIndex(null)}))}__onUserCombobox(){return()=>{this.__updatePopupControls()}}__updatePopupControls(){this.__userCombobox&&(this.__selectedUserName=this.__userCombobox.getSelectedValue(),this.__selectedUserName?this.__confirmButton?.setIsEnabled(!0):this.__confirmButton?.setIsEnabled(!1))}__deleteUser(username){TcHmi.Server.UserManagement.removeUserEx(username,{domain:this.__selectedDomain},null,(data=>{if(data.error===TcHmi.Errors.NONE)this.__updateComboboxData();else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_UserNotDeleted"),formatValues:[error,message,this.__selectedUserName]}}),this.__feedbackPrompt.prompt()}}))}__onConfirm(){return()=>{(async()=>{if(this.__selectedUserName){this.__deleteConfirmationPrompt||(this.__deleteConfirmationPrompt=new Controls.Helpers.TextAndButtonsPrompt({yes:{value:!0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("PopupButton_Delete")}},no:{value:!1,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("PopupButton_Close")}}},this.__parentControl),this.__deleteConfirmationPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_DeleteUser"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_DeleteUserConfirmation"),formatValues:[this.__selectedUserName]}}));await this.__deleteConfirmationPrompt.prompt()&&this.__deleteUser(this.__selectedUserName)}})()}}__onAdvanced(){return()=>{this.__updateComboboxData(),this.__parentControl.setAdvancedState("Active"===this.__advancedSwitch?.getToggleState())}}__onCancel(){return()=>{this.hide()}}__updateFontSizes(){super.__updateFontSizes(),this.__userCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__userCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null)}}TcHmiUserManagementPopups.DeleteUserPopup=DeleteUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class ChangeUserPopup extends TcHmiUserManagementPopups.Popup{constructor(element,parentControl,parentPopup){super(element,parentControl),this.__groupList=null,this.__groupCheckboxes=new Map,this.__userList={},this.__groupConfigurations=new Map,this.__groupCheckboxEventDestroyer=[],this.__parentPopup=parentPopup,this.__evtHandlerGroupScroll=this.__onGroupScroll(),this.__addLocalizedElement(this.__elementHeadline,"Popup_ChangeUsers"),this.__elementContent_2=this.__element.getElementsByClassName("content_2")[0],this.__elementContentGroups=document.createElement("div"),this.__elementContentGroups.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-groups"),this.__elementContent.textContent="",this.__elementContent_2.textContent="",void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CloseButton_ChangeUsersPopup")&&(this.__closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".CloseButton_ChangeUsersPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Close%/l%"},this.__parentControl),this.__closeButton&&(this.__closeButton.getElement()[0].classList.add("cancelbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CloseButton_ChangeUsersPopup.onPressed",this.__onCancel())),this.__elementFooter.append(this.__closeButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".ConfirmButton_ChangeUsersPopup")&&(this.__confirmButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".ConfirmButton_ChangeUsersPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_OK%/l%"},this.__parentControl),this.__confirmButton&&(this.__confirmButton.getElement()[0].classList.add("confirmbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".ConfirmButton_ChangeUsersPopup.onPressed",this.__onConfirm())),this.__elementFooter.append(this.__confirmButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".AdvancedToggleSwitch_ChangeUsersPopup")&&(this.__advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",this.__parentControl.getId()+".AdvancedToggleSwitch_ChangeUsersPopup",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupToggleSwitch_Advanced%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupAdvancedToggleSwitchTooltip_ChangeUser%/l%"},this.__parentControl),this.__advancedSwitch&&(this.__advancedSwitch.getElement()[0].classList.add("advanced-switch"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".AdvancedToggleSwitch_ChangeUsersPopup.onToggleStateChanged",this.__onAdvanced())),this.__elementFooter.append(this.__advancedSwitch.getElement()[0]))),this.__createUserSelectionCombobox();this.__elementContentGroups.addEventListener("scroll",this.__evtHandlerGroupScroll,{passive:!0,capture:!1})}show(){super.show(),this.__groupConfigurations.clear(),this.__advancedSwitch?.setToggleState(this.__parentControl.getAdvancedState()?"Active":"Normal"),this.__updateComboboxData(),this.__createUserGroupSelection(),setTimeout((()=>{this.__setGroupScrollData()}),50)}destroy(){super.destroy(),this.__confirmButton?.destroy(),this.__confirmButton=void 0,this.__closeButton?.destroy(),this.__closeButton=void 0,this.__advancedSwitch?.destroy(),this.__advancedSwitch=void 0,this.__userCombobox?.destroy(),this.__userCombobox=void 0,this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[];this.__elementContentGroups.removeEventListener("scroll",this.__evtHandlerGroupScroll,{passive:!0,capture:!1})}__createUserSelectionCombobox(){let username=document.createElement("h2");username.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(username,"PopupHeadline_SelectUser"),this.__elementContent.append(username),this.__userCombobox=TcHmi.Controls.get(this.__parentControl.getId()+".CB_UserSelection_ChangeUser_Popup"),void 0===this.__userCombobox&&(this.__userCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".CB_UserSelection_ChangeUser_Popup",{"data-tchmi-combobox-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_SelectAUser%/l%","data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__userCombobox&&(this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CB_UserSelection_ChangeUser_Popup.onSelectionChanged",this.__onUserCombobox())),this.__elementContent.append(this.__userCombobox.getElement()[0]),this.__userCombobox.getElement().find("polyline").css("stroke","")))}__updateComboboxData(){let currentSelection=this.__userCombobox?.getSelectedText();TcHmi.Server.UserManagement.listUsersEx({domain:this.__selectedDomain},null,(data=>{(async()=>{if(data.error===TcHmi.Errors.NONE){if(data.userDetails&&(this.__userList=data.userDetails),this.__userCombobox){let users=Object.keys(this.__userList);"Normal"===this.__advancedSwitch?.getToggleState()&&(users=users.filter((user=>!user.startsWith("__")))),this.__userCombobox.setSrcData(users),users.length>0?this.__userCombobox.setSelectedIndex(0):this.__userCombobox.setSelectedIndex(null)}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserError"),formatValues:[error,message]}}),await this.__feedbackPrompt.prompt(),this.hide()}let srcData=this.__userCombobox?.getSrcData();if(srcData?.length>0&&currentSelection){let index=srcData?.indexOf(currentSelection);-1!==index?this.__userCombobox?.setSelectedIndex(index):this.__userCombobox?.setSelectedIndex(0)}else this.__userCombobox?.setSelectedIndex(null);this.__updatePopupControls()})()}))}__onUserCombobox(){return()=>{this.__updatePopupControls()}}__updatePopupControls(){if(this.__userCombobox&&(this.__selectedUserName=this.__userCombobox.getSelectedValue(),this.__selectedUserName)){let user=this.__userList[this.__selectedUserName];if(user){this.__selectedUserDetails=user;let userGroupsConfig=this.__groupConfigurations.get(this.__selectedUserName);return userGroupsConfig||(userGroupsConfig=this.__selectedUserDetails?.groups?[...this.__selectedUserDetails.groups]:[],this.__groupConfigurations.set(this.__selectedUserName,userGroupsConfig)),this.__confirmButton?.setIsEnabled(!0),this.__groupCheckboxes.forEach(((checkbox,group)=>{checkbox.setTooltip(null),checkbox.setIsEnabled(!0),userGroupsConfig?.includes(group)?checkbox.setToggleState("Active"):checkbox.setToggleState("Normal")})),"__SystemGuest"===this.__selectedUserName&&this.__groupCheckboxes.get("__SystemGuests")?.setIsEnabled(!1),"__SystemUser"===this.__selectedUserName&&this.__groupCheckboxes.get("__SystemUsers")?.setIsEnabled(!1),void("__SystemAdministrator"===this.__selectedUserName&&this.__groupCheckboxes.get("__SystemAdministrators")?.setIsEnabled(!1))}}this.__selectedUserDetails=void 0,this.__confirmButton?.setIsEnabled(!1),this.__groupCheckboxes.forEach((checkbox=>{checkbox.setIsEnabled(!1),checkbox.setToggleState("Normal"),checkbox.setTooltip(TcHmi.Symbol.read("Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_SelectAUser",TcHmi.SymbolType.LocalizedText)??null)}))}__createUserGroupSelection(){TcHmi.Server.UserManagement.listUserGroups((data=>{(async()=>{if(data.error===TcHmi.Errors.NONE){if(data.groupDetailsList){let newGroupList=Object.keys(data.groupDetailsList);if("Normal"===this.__advancedSwitch?.getToggleState()&&(newGroupList=newGroupList.filter((group=>!group.startsWith("__")))),!tchmi_equal(this.__groupList,newGroupList)){this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__elementContent_2.textContent="";let userGroups=document.createElement("h2");userGroups.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(userGroups,"PopupHeadline_UserGroups"),this.__elementContent_2.append(userGroups,this.__elementContentGroups),this.__groupList=newGroupList,this.__groupList.length>0?(this.__elementContentGroups.textContent="",this.__removeLocalizedElement(this.__elementContent_2),this.__groupList.forEach((group=>{this.__createGroupCheckbox(group)}))):this.__addLocalizedElement(this.__elementContentGroups,"PopupNotificationInfo_NoUserGroups"),this.__updatePopupControls(),this.__setGroupScrollData()}}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserGroupError"),formatValues:[error,message]}}),await this.__feedbackPrompt.prompt(),this.hide()}})()}))}__createGroupCheckbox(name){if(void 0===TcHmi.Controls.get(this.__parentControl.getId()+".UserGroupCheckbox_ChangeUser_Popup"+name)){let checkbox=TcHmi.ControlFactory.create("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__parentControl.getId()+".UserGroupCheckbox_ChangeUser_Popup"+name,this.__parentControl);checkbox&&(checkbox.setText(name),this.__groupCheckboxes.set(name,checkbox),this.__elementContentGroups.append(checkbox.getElement()[0]),this.__groupCheckboxEventDestroyer.push(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onGroupCheckbox(checkbox,name))))}}__onGroupCheckbox(checkbox,groupName){return()=>{if(this.__selectedUserName){let userGroupsConfig=this.__groupConfigurations.get(this.__selectedUserName);"Normal"===checkbox.getToggleState()&&userGroupsConfig?this.__groupConfigurations.set(this.__selectedUserName,userGroupsConfig.filter((group=>group!==groupName))):userGroupsConfig&&!userGroupsConfig.includes(groupName)&&userGroupsConfig.push(groupName)}}}__updateUser(username,groupsToAdd,groupsToRemove){let updateData={};groupsToAdd&&groupsToAdd.length>0&&(updateData.addGroups=groupsToAdd),groupsToRemove&&groupsToRemove.length>0&&(updateData.removeGroups=groupsToRemove),updateData.domain=this.__selectedDomain,username&&updateData&&TcHmi.Server.UserManagement.updateUser(username,updateData,(data=>{if(data.error===TcHmi.Errors.NONE)username===TcHmi.Server.getCurrentUserConfig().name&&(this.__parentControl.updateDropdown(),this.__parentPopup.updateDomains(),this.__updateComboboxData());else{let error=data.error,message="",reason="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")"),data.details.errors[0].reason&&(reason=data.details.errors[0].reason)),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_UserGroupsNotUpdated"),formatValues:[error,message,reason,username]}}),this.__feedbackPrompt.prompt()}this.__updateComboboxData()}))}__onConfirm(){return()=>{let groupsToAdd=[],groupsToRemove=[];this.__groupCheckboxes&&this.__selectedUserDetails&&(groupsToRemove=this.__selectedUserDetails.groups.filter((group=>"Normal"===this.__groupCheckboxes.get(group)?.getToggleState())),groupsToAdd=this.__groupList?.filter((group=>"Active"===this.__groupCheckboxes.get(group)?.getToggleState()&&!this.__selectedUserDetails.groups.includes(group)))??[]),this.__selectedUserName&&this.__updateUser(this.__selectedUserName,groupsToAdd,groupsToRemove)}}__onAdvanced(){return()=>{this.__createUserGroupSelection(),this.__updateComboboxData(),this.__parentControl.setAdvancedState("Active"===this.__advancedSwitch?.getToggleState())}}__onGroupScroll(){return e=>{this.__setGroupScrollData()}}__setGroupScrollData(){this.__elementContentGroups.clientHeight+this.__elementContentGroups.scrollTop===this.__elementContentGroups.scrollHeight?this.__elementContentGroups.dataset.scroll=0===this.__elementContentGroups.scrollTop?"none":"bottom":this.__elementContentGroups.dataset.scroll=0===this.__elementContentGroups.scrollTop?"top":"center"}__onCancel(){return()=>{this.hide()}}__updateFontSizes(){super.__updateFontSizes(),this.__userCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__userCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null)}}TcHmiUserManagementPopups.ChangeUserPopup=ChangeUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class SwitchUserPopup extends TcHmiUserManagementPopups.Popup{constructor(element,parentControl){if(super(element,parentControl),this.__userSelectType="Input",this.__elementUsername=this.__element.getElementsByClassName("content_2")[0],this.__elementPassword=this.__element.getElementsByClassName("content_3")[0],this.__domainHeadline=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-headline-2")[0],this.__usernameHeadline=this.__elementUsername.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-popup-headline-3")[0],!this.__elementUsername||!this.__elementPassword||!this.__usernameHeadline)throw new Error("Invalid Template.html");this.__addLocalizedElement(this.__elementHeadline,"Popup_SwitchUser"),this.__addLocalizedElement(this.__usernameHeadline,"PopupHeadline_SelectUser"),this.__addLocalizedElement(this.__domainHeadline,"PopupHeadline_Domain"),this.__elementPassword.textContent="",void 0===TcHmi.Controls.get(this.__parentControl.getId()+".CloseButton_SwitchUser")&&(this.__closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".CloseButton_SwitchUser",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Close%/l%"},this.__parentControl),this.__closeButton&&(this.__closeButton.getElement()[0].classList.add("cancelbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CloseButton_SwitchUser.onPressed",this.__onCancel())),this.__elementFooter.append(this.__closeButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".ConfirmButton_SwitchUser")&&(this.__confirmButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".ConfirmButton_SwitchUser",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Switch%/l%","data-tchmi-is-enabled":!1},this.__parentControl),this.__confirmButton&&(this.__confirmButton.getElement()[0].classList.add("confirmbutton"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".ConfirmButton_SwitchUser.onPressed",this.__onConfirm())),this.__elementFooter.append(this.__confirmButton.getElement()[0]))),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".AdvancedToggleSwitch_SwitchUser")&&(this.__advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",this.__parentControl.getId()+".AdvancedToggleSwitch_SwitchUser",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupToggleSwitch_Advanced%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupAdvancedToggleSwitchTooltip_SwitchUser%/l%"},this.__parentControl),this.__advancedSwitch&&(this.__advancedSwitch.getElement()[0].classList.add("advanced-switch"),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".AdvancedToggleSwitch_SwitchUser.onToggleStateChanged",this.__onAdvanced())),this.__elementFooter.append(this.__advancedSwitch.getElement()[0]))),this.__updateUserSelection(),this.__createPasswordInput()}show(){super.show(),this.__updateDomains(),this.__advancedSwitch?.setToggleState(this.__parentControl.getAdvancedState()?"Active":"Normal")}destroy(){super.destroy(),this.__confirmButton?.destroy(),this.__confirmButton=void 0,this.__closeButton?.destroy(),this.__closeButton=void 0,this.__domainCombobox?.destroy(),this.__domainCombobox=void 0,this.__advancedSwitch?.destroy(),this.__advancedSwitch=void 0,this.__userCombobox?.destroy(),this.__userCombobox=void 0,this.__passwordInput?.destroy(),this.__passwordInput=void 0,this.__usernameInput?.destroy(),this.__usernameInput=void 0}__updateDomains(){TcHmi.Server.readSymbol("ListDomains",(data=>{const domainList=data.response?.commands?.[0].readValue;if(data.error===TcHmi.Errors.NONE&&domainList){const domains=[];for(let[domainName,domain]of Object.entries(domainList))domain?.authExtension&&domains.push(domainName);if(domains.length<1)this.__elementContent.classList.add("not-displayed"),this.__selectedDomain=TcHmi.Server.getCurrentUserConfig().defaultAuthExtension;else if(1===domains.length)this.__selectedDomain=domains[0],this.__elementContent.classList.add("not-displayed");else{this.__createDomainCombobox();let defaultDomain=TcHmi.Server.getCurrentUserConfig().defaultAuthExtension;if(this.__domainCombobox){this.__elementContent.classList.remove("not-displayed"),this.__domainCombobox.setSrcData(domains);let index=domains.findIndex((x=>x===defaultDomain))??0;this.__domainCombobox.setSelectedIndex(index)}}}this.__updateUserSelection()}))}__createDomainCombobox(){this.__domainCombobox=TcHmi.Controls.get(this.__parentControl.getId()+".DomainCombobox-SwitchUser"),this.__domainCombobox||(this.__domainCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".DomainCombobox-SwitchUser",{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),this.__domainCombobox&&(this.__elementContent.append(this.__domainCombobox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".DomainCombobox-SwitchUser.onSelectionChanged",this.__onDomainSelectionChanged()))))}__updateUserSelection(){TcHmi.Server.readSymbol("UserSelectType",(data=>{data.error!==TcHmi.Errors.NONE||0!==data.results?.[0].value?this.__showSelectionInput():this.__showSelectionCombobox()}))}__createUserSelectionCombobox(){this.__userCombobox=TcHmi.Controls.get(this.__parentControl.getId()+".CB_UserSelection_SwitchUser_Popup"),this.__userCombobox||(this.__userCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__parentControl.getId()+".CB_UserSelection_SwitchUser_Popup",{"data-tchmi-combobox-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_SelectAUser%/l%","data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl)),this.__userCombobox&&(this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".CB_UserSelection_SwitchUser_Popup.onSelectionChanged",this.__onUserCombobox())),this.__userCombobox.getElement().find("polyline").css("stroke",""))}__createUsernameInput(){this.__usernameInput=TcHmi.Controls.get(this.__parentControl.getId()+".UsernameInput_Popup_SwitchUser"),this.__usernameInput||(this.__usernameInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput",this.__parentControl.getId()+".UsernameInput_Popup_SwitchUser",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_EnterYourUserName%/l%"},this.__parentControl))}__showSelectionCombobox(){this.__userSelectType="Combobox",this.__usernameInput?.getElement()[0].remove(),this.__userCombobox||this.__createUserSelectionCombobox(),this.__userCombobox&&this.__elementUsername.append(this.__userCombobox.getElement()[0]),this.__advancedSwitch?.setVisibility("Visible"),this.__updateComboboxData()}__showSelectionInput(){this.__userSelectType="Input",this.__userCombobox?.getElement()[0].remove(),this.__usernameInput||this.__createUsernameInput(),this.__usernameInput&&this.__elementUsername.append(this.__usernameInput.getElement()[0]),this.__advancedSwitch?.setVisibility("Collapsed"),this.__confirmButton?.setIsEnabled(!0)}__updateComboboxData(){let currentSelection=this.__userCombobox?.getSelectedText();TcHmi.Server.UserManagement.listUsernamesEx({domain:this.__selectedDomain},null,(data=>{if(data.error===TcHmi.Errors.NONE){if(data.userList){let userList=data.userList;"Normal"===this.__advancedSwitch?.getToggleState()&&(userList=userList.filter((user=>!user.startsWith("__"))));let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(currentUserConfigurations?.name){let userIndex=userList.indexOf(currentUserConfigurations.name);-1!==userIndex&&userList.splice(userIndex,1)}this.__userCombobox&&this.__userCombobox.setSrcData(userList)}}else this.__showSelectionInput();let srcData=this.__userCombobox?.getSrcData();if(srcData?.length>0&&currentSelection){let index=srcData?.indexOf(currentSelection);-1!==index?this.__userCombobox?.setSelectedIndex(index):this.__userCombobox?.setSelectedIndex(null)}else this.__userCombobox?.setSelectedIndex(null)}))}__createPasswordInput(){let password=document.createElement("h2");password.style.fontSize=this.__subHeadlineFontSize+(this.__subHeadlineFontSizeUnit??"px"),this.__addLocalizedElement(password,"PopupHeadline_Password"),this.__elementPassword.append(password),void 0===TcHmi.Controls.get(this.__parentControl.getId()+".PasswordInput_Popup_SwitchUser")&&(this.__passwordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",this.__parentControl.getId()+".PasswordInput_Popup_SwitchUser",{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_Password%/l%"},this.__parentControl),this.__passwordInput&&this.__elementPassword.append(this.__passwordInput.getElement()[0]))}__onUserCombobox(){return()=>{this.__updatePopupControls()}}__updatePopupControls(){this.__userCombobox&&(this.__selectedUserName=this.__userCombobox.getSelectedValue(),this.__selectedUserName?this.__confirmButton?.setIsEnabled(!0):this.__confirmButton?.setIsEnabled(!1))}__onConfirm(){return()=>{if(this.__usernameInput&&"Input"===this.__userSelectType&&(this.__selectedUserName=this.__usernameInput.getText()),!this.__selectedUserName||""===this.__selectedUserName)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_Username")}),void this.__feedbackPrompt.prompt();let password=this.__passwordInput?.getText();if(!password||""===password)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:this.__expandLocalizationSymbol("PopupFeedback_Password")}),void this.__feedbackPrompt.prompt();TcHmi.Server.loginEx2((this.__selectedDomain?this.__selectedDomain+"::":"")+this.__selectedUserName,password,!0,!1,null,(data=>{if(data.error===TcHmi.Errors.NONE)this.__updateUserSelection();else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.error("login failed "+TcHmi.Log.buildMessage(data.details)),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),contentText:{symbolExpression:this.__expandLocalizationSymbol("PopupNotificationInfo_UserNotSwitched"),formatValues:[error,message]}}),this.__feedbackPrompt.prompt()}}))}}__onAdvanced(){return()=>{this.__updateUserSelection(),this.__parentControl.setAdvancedState("Active"===this.__advancedSwitch?.getToggleState())}}__onCancel(){return()=>{this.hide()}}__onDomainSelectionChanged(){return()=>{this.__selectedDomain=this.__domainCombobox?.getSelectedValue(),this.__updateUserSelection()}}__updateFontSizes(){super.__updateFontSizes(),this.__userCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__userCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null),this.__domainCombobox?.setDropDownFontSize(this.__textFontSize??null),this.__domainCombobox?.setDropDownFontSizeUnit(this.__textFontSizeUnit??null)}}TcHmiUserManagementPopups.SwitchUserPopup=SwitchUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));